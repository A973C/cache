language: php
php:
  - 5.3
  - 5.4
  - 5.5

env:
  - CACHE=apc
  - CACHE=redis

before_script:
  - sh -c "if [ '$CACHE' = 'apc' ]; then psql -c 'DROP DATABASE IF EXISTS phpbb_tests;' -U postgres; fi"
  - sh -c "if [ '$DB' = 'redis' ]; then psql -c 'create database phpbb_tests;' -U postgres; fi"
  - cd apix
  - php ../composer.phar install --dev
  - cd ../

 before_script:
  - pecl -q install redis && echo "extension=redis.so" >> `php --ini | grep "Loaded Configuration" | sed -e "s|.*:\s*||"`
  - curl -s http://getcomposer.org/installer | php
  - php composer.phar --dev install

script:
  - phpunit --configuration travis/phpunit-$DB-travis.xml

notifications:
  email:
    recipients:
      - dev-team@ouarz.net
    on_success: change
    on_failure: change
